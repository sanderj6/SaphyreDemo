@using MudBlazor
@using SaphyreDemo.Pages.Admin.Orders.Components
@using SaphyreDemo.Services.Modal
@using SaphyreDemo.Services.Order
@using SaphyreDemo.Services.Toast
@using SaphyreDemo.Templates.Forms
@using SaphyreDemo.Templates.Tables
@using SaphyreDemo.Templates.Misc
@using Data.Enums

<div class="container">
	<EditForm EditContext="@editContext"
			  OnValidSubmit="HandleSubmit">
		<DataAnnotationsValidator />

		<div>

			<div class="saphyre-form d-flex flex-md-row flex-column">
				<div class="col-md-6 col-12">
					<Saphyre_Textbox FieldExpression="@(() => Model.Description)" CSSClass="form-input" />
				</div>

				<div class="col-md-6 col-12">
					<Saphyre_Select_Single FieldExpression="(() => Model.ShippingType.Name)"
										   Data="shippingOptions" />
				</div>
			</div>

			<div class="saphyre-form d-flex flex-md-row flex-column align-items-center">
				<div class="col-md-6 col-12">
					<div class="col-md-4 col-12">
						<Saphyre_Numberbox FieldExpression="@(() => Model.Amount)" CSSClass="form-input" />
					</div>

					<Saphyre_Select_Single FieldExpression="(() => Model.ShippingType.Name)"
										   Data="shippingOptions" />
				</div>
			</div>

			<div class="saphyre-form d-flex flex-md-row flex-column">
				<div class="col-12">
					<Saphyre_Select_Grid IsGridEditable="true" />
				</div>
			</div>

			<div class="saphyre-form d-flex flex-md-row flex-column">
				<div class="col-md-4 col-12">
					<Saphyre_Numberbox InputValue="Model.TaxPercentage" IsPercentage="true" CSSClass="form-input" />
				</div>

				<div class="col-md-4 col-12">
					<Saphyre_Date FieldExpression="@(() => Model.Date)" CSSClass="form-input" />
				</div>
			</div>

			<div class="saphyre-form d-flex justify-content-end pt-4 gap-3">
				<button @onclick="HandleCancel" type="button" class="btn btn-secondary modalButton">
					Cancel
				</button>
				<button type="submit" class="btn btn-primary modalButton">
					Submit Order
				</button>
			</div>

		</div>

	</EditForm>
</div>

@code {
	[Parameter]
	public OrderDescription Model { get; set; }

	[Parameter]
	public Action<bool> Callback { get; set; }

	private EditContext editContext { get; set; }

	private CurrencyList currencyList = new();
	private List<DropDownItem> shippingOptions = new()
					{
		new DropDownItem()
		{
			Id = Guid.NewGuid(),
			Name = "Expedited"
		},
		new DropDownItem()
		{
			Id = Guid.NewGuid(),
			Name = "Overnight"
		},
		new DropDownItem()
		{
			Id = Guid.NewGuid(),
			Name = "Priority"
		},
		new DropDownItem()
		{
			Id = Guid.NewGuid(),
			Name = "Standard"
		}
					};

	protected override async Task OnInitializedAsync()
	{
		Model ??= new();
		editContext = new EditContext(Model);
	}


	public async Task HandleSubmit()
	{
		Callback?.Invoke(true);
	}


	public async Task HandleCancel()
	{
		Callback?.Invoke(false);
	}

	private RenderFragment<Currency> CurrencyItemTemplate => item => builder =>
					{
	builder.OpenComponent<MudSelectItem<Currency>>(0); // Specify the type argument here
	builder.AddAttribute(1, "Value", item.Name);
	builder.AddContent(2,
	@<div class="dropdown-item-layout">
		<div class="column1">@item.ISOCode</div>
		<div class="column2">@item.Name</div>
	</div>);
	builder.CloseComponent();
				};

}
